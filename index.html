<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MLBB Mobile Prototype</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; touch-action: none; font-family: sans-serif; }
        canvas { display: block; }

        /* МЕНЮ ВЫБОРА */
        #menu {
            position: absolute; inset: 0; background: radial-gradient(circle, #1a2a3a 0%, #050505 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100;
        }
        .hero-card {
            width: 250px; padding: 20px; margin: 10px; border: 2px solid #cd9d1d;
            background: rgba(0,0,0,0.6); color: gold; text-align: center;
            border-radius: 15px; font-size: 22px; font-weight: bold; cursor: pointer;
        }

        /* ИНТЕРФЕЙС ИГРЫ */
        #ui { display: none; pointer-events: none; position: absolute; inset: 0; }
        
        #joystick-zone {
            position: absolute; bottom: 40px; left: 40px; width: 150px; height: 150px;
            background: rgba(255,255,255,0.05); border-radius: 50%; pointer-events: auto;
        }
        #joystick-stick {
            position: absolute; top: 50%; left: 50%; width: 60px; height: 60px;
            background: #fff; opacity: 0.4; border-radius: 50%; transform: translate(-50%, -50%);
        }

        #attack-btn {
            position: absolute; bottom: 50px; right: 50px; width: 90px; height: 90px;
            background: rgba(205,157,29,0.5); border: 4px solid #fff; border-radius: 50%;
            pointer-events: auto; display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 18px;
        }
    </style>
</head>
<body>

    <div id="menu">
        <h2 style="color: #fff; text-transform: uppercase; letter-spacing: 2px;">Выберите героя</h2>
        <div class="hero-card" onclick="initGame(0x00aaff, 'МАГ')">МАГ (Синий)</div>
        <div class="hero-card" onclick="initGame(0xff4400, 'БОЕЦ')">БОЕЦ (Красный)</div>
    </div>

    <div id="ui">
        <div id="joystick-zone"><div id="joystick-stick"></div></div>
        <div id="attack-btn">ATK</div>
    </div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

        let scene, camera, renderer, hero;
        let moveX = 0, moveZ = 0, isMoving = false;

        window.initGame = (color, name) => {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('ui').style.display = 'block';
            
            // Сцена
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a100a);

            // Камера (Изометрия как в MLBB)
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 20, 15);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // Свет
            scene.add(new THREE.AmbientLight(0xffffff, 0.7));
            const sun = new THREE.DirectionalLight(0xffffff, 1);
            sun.position.set(10, 20, 10);
            scene.add(sun);

            // Карта (Платформа)
            const groundGeo = new THREE.PlaneGeometry(200, 200);
            const groundMat = new THREE.MeshStandardMaterial({ color: 0x152515 });
            const ground = new THREE.Mesh(groundGeo, groundMat);
            ground.rotation.x = -Math.PI / 2;
            scene.add(ground);

            // Сетка для визуализации движения
            const grid = new THREE.GridHelper(200, 100, 0x224422, 0x112211);
            grid.position.y = 0.01;
            scene.add(grid);

            // Герой
            const heroGeo = new THREE.CapsuleGeometry(0.6, 1.2, 4, 8);
            const heroMat = new THREE.MeshStandardMaterial({ color: color });
            hero = new THREE.Mesh(heroGeo, heroMat);
            hero.position.y = 1.2;
            scene.add(hero);

            setupControls();
            animate();
        };

        function setupControls() {
            const zone = document.getElementById('joystick-zone');
            const stick = document.getElementById('joystick-stick');

            const onTouch = (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = zone.getBoundingClientRect();
                const cx = rect.left + rect.width / 2;
                const cy = rect.top + rect.height / 2;
                const dx = touch.clientX - cx;
                const dy = touch.clientY - cy;
                const dist = Math.min(Math.sqrt(dx*dx + dy*dy), 60);
                const angle = Math.atan2(dy, dx);

                stick.style.transform = `translate(calc(-50% + ${Math.cos(angle)*dist}px), calc(-50% + ${Math.sin(angle)*dist}px))`;
                
                moveX = Math.cos(angle) * (dist / 60);
                moveZ = Math.sin(angle) * (dist / 60);
                isMoving = true;
            };

            zone.addEventListener('touchstart', onTouch, {passive: false});
            zone.addEventListener('touchmove', onTouch, {passive: false});
            zone.addEventListener('touchend', () => {
                isMoving = false;
                moveX = 0; moveZ = 0;
                stick.style.transform = 'translate(-50%, -50%)';
            });

            document.getElementById('attack-btn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                // Анимация атаки (быстрый наклон вперед)
                hero.rotation.x = 0.5;
                setTimeout(() => hero.rotation.x = 0, 150);
            });
        }

        function animate() {
            requestAnimationFrame(animate);

            if (isMoving) {
                const speed = 0.2;
                hero.position.x += moveX * speed;
                hero.position.z += moveZ * speed;
                
                // Поворот в сторону бега
                hero.rotation.y = -Math.atan2(moveZ, moveX) + Math.PI/2;
            }

            // КАМЕРА СЛЕДИТ ЗА ГЕРОЕМ
            camera.position.x = hero.position.x;
            camera.position.z = hero.position.z + 15;
            camera.lookAt(hero.position.x, 0, hero.position.z);

            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            if (!camera) return;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
