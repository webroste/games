<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MLBB Stable Build</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; touch-action: none; font-family: sans-serif; user-select: none; }
        .screen { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; }
        
        /* –ú–ï–ù–Æ */
        #menu-screen { background: radial-gradient(circle, #1b2735 0%, #000 100%); }
        h1 { color: #f1c40f; font-size: 32px; text-transform: uppercase; letter-spacing: 3px; text-align: center; }

        /* –ó–ê–ì–†–£–ó–ö–ê */
        #loading-screen { background: #000; display: none; z-index: 100; }
        .bar { width: 200px; height: 6px; background: #222; border-radius: 3px; margin-top: 20px; overflow: hidden; }
        .fill { width: 0%; height: 100%; background: #f1c40f; transition: width 0.2s; }

        /* –ù–ê–°–¢–†–û–ô–ö–ò */
        #settings-screen { background: rgba(0,0,0,0.95); display: none; color: white; z-index: 150; }
        .row { width: 280px; display: flex; justify-content: space-between; margin: 15px 0; font-size: 14px; }
        
        .btn {
            background: #2980b9; border: 2px solid #f1c40f; color: white; padding: 12px 30px;
            font-size: 16px; font-weight: bold; border-radius: 5px; cursor: pointer; margin: 10px;
        }

        /* –ò–ì–†–û–í–û–ô UI */
        #game-ui { display: none; pointer-events: none; }
        #minimap { position: absolute; top: 15px; left: 15px; width: 110px; height: 110px; background: rgba(0,20,0,0.8); border: 1px solid #555; pointer-events: none; }
        #joy-base { position: absolute; bottom: 50px; left: 50px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.2); border-radius: 50%; pointer-events: auto; }
        #joy-stick { position: absolute; top: 50%; left: 50%; width: 40px; height: 40px; background: #fff; opacity: 0.5; border-radius: 50%; transform: translate(-50%, -50%); }
        #actions { position: absolute; bottom: 50px; right: 50px; display: flex; gap: 15px; align-items: flex-end; pointer-events: auto; }
        .skill { width: 60px; height: 60px; border-radius: 50%; background: rgba(0,0,0,0.6); border: 2px solid #fff; color: #fff; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        #msg { position: absolute; bottom: 180px; width: 100%; text-align: center; color: #0ff; font-weight: bold; display: none; }
    </style>
</head>
<body>

    <div id="menu-screen" class="screen">
        <h1>MOBA LEGENDS</h1>
        <button class="btn" onclick="showLoading()">–ò–ì–†–ê–¢–¨</button>
        <button class="btn" onclick="toggleSets(true)">–ù–ê–°–¢–†–û–ô–ö–ò</button>
    </div>

    <div id="loading-screen" class="screen">
        <h3 style="color:white">–ó–ê–ì–†–£–ó–ö–ê...</h3>
        <div class="bar"><div id="fill" class="fill"></div></div>
    </div>

    <div id="settings-screen" class="screen">
        <h2>–ù–ê–°–¢–†–û–ô–ö–ò</h2>
        <div class="row"><span>–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</span><input type="range" id="sens" min="0.5" max="3" step="0.1" value="1.5"></div>
        <div class="row"><span>–ò–Ω–≤–µ—Ä—Å–∏—è X:</span><input type="checkbox" id="invX"></div>
        <div class="row"><span>–ò–Ω–≤–µ—Ä—Å–∏—è Y:</span><input type="checkbox" id="invY"></div>
        <button class="btn" onclick="toggleSets(false)">–ì–û–¢–û–í–û</button>
    </div>

    <div id="game-ui" class="screen">
        <div id="minimap"></div>
        <div id="joy-base"><div id="joy-stick"></div></div>
        <div id="msg">–í–û–ó–í–†–ê–©–ï–ù–ò–ï... <span id="timer">5</span></div>
        <div id="actions">
            <div class="skill" style="background:#4834d4" onclick="doRecall()">üè†</div>
            <div class="skill" style="width:80px; height:80px; background:#eb4d4b; font-size:30px">‚öîÔ∏è</div>
        </div>
        <div id="cam-zone" style="position:absolute; right:0; top:0; width:50%; height:100%; pointer-events:auto;"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        let scene, camera, renderer, player, obstacles = [];
        let isMoving = false, joyX = 0, joyZ = 0;
        let isRecalling = false, recallInterval;
        let camPan = { x: 0, z: 0 };
        let cfg = { sens: 1.5, invX: 1, invY: 1 };

        function toggleSets(s) { document.getElementById('settings-screen').style.display = s ? 'flex' : 'none'; }

        function showLoading() {
            document.getElementById('menu-screen').style.display = 'none';
            document.getElementById('loading-screen').style.display = 'flex';
            let p = 0;
            let iv = setInterval(() => {
                p += 10;
                document.getElementById('fill').style.width = p + '%';
                if(p >= 100) { clearInterval(iv); init(); }
            }, 100);
        }

        function init() {
            cfg.sens = parseFloat(document.getElementById('sens').value);
            cfg.invX = document.getElementById('invX').checked ? -1 : 1;
            cfg.invY = document.getElementById('invY').checked ? -1 : 1;

            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('game-ui').style.display = 'block';

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x05080a);
            scene.fog = new THREE.Fog(0x05080a, 15, 70);

            camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            scene.add(new THREE.AmbientLight(0xffffff, 0.6));
            let sun = new THREE.DirectionalLight(0xffffff, 0.8);
            sun.position.set(10, 20, 10);
            scene.add(sun);

            // –ö–ê–†–¢–ê
            let ground = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({color: 0x1a261a}));
            ground.rotation.x = -Math.PI/2;
            scene.add(ground);

            // –û–±—ä–µ–∫—Ç—ã
            addBox(-40, 40, 5, 8, 0x1e3799, true); // –ë–∞–∑–∞ —Å–∏–Ω–∏—Ö
            addBox(40, -40, 5, 8, 0xb71540, true); // –ë–∞–∑–∞ –∫—Ä–∞—Å–Ω—ã—Ö

            for(let i=0; i<40; i++) {
                let rx = (Math.random()-0.5)*80, rz = (Math.random()-0.5)*80;
                if(Math.abs(rx+rz) > 15) addBox(rx, rz, 1.5, 4, 0x2d3436, false);
            }

            // –ì–ï–†–û–ô (–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ)
            player = new THREE.Group();
            let pGeo;
            try {
                pGeo = new THREE.CapsuleGeometry(0.5, 1, 4, 8); // –ü—Ä–æ–±—É–µ–º –∫–∞–ø—Å—É–ª—É
            } catch(e) {
                pGeo = new THREE.CylinderGeometry(0.5, 0.5, 1.5, 8); // –ï—Å–ª–∏ –Ω–µ—Ç - –æ–±—ã—á–Ω—ã–π —Ü–∏–ª–∏–Ω–¥—Ä
            }
            let pMesh = new THREE.Mesh(pGeo, new THREE.MeshStandardMaterial({color: 0x00a8ff}));
            pMesh.position.y = 0.75;
            player.add(pMesh);
            scene.add(player);
            player.position.set(-35, 0, 35);

            // –¢–æ—á–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
            let dot = document.createElement('div');
            dot.id = "p-dot";
            dot.style.cssText = "position:absolute; width:5px; height:5px; background:#0f0; border-radius:50%;";
            document.getElementById('minimap').appendChild(dot);

            setupControls();
            animate();
        }

        function addBox(x, z, r, h, col, isBase) {
            let m = new THREE.Mesh(new THREE.CylinderGeometry(r, r, h, 8), new THREE.MeshStandardMaterial({color: col}));
            m.position.set(x, h/2, z);
            m.userData.r = r;
            scene.add(m);
            obstacles.push(m);
            if(isBase) {
                let d = document.createElement('div');
                d.style.cssText = `position:absolute; width:4px; height:4px; background:gold; border-radius:50%; left:${((x+50)/100)*110}px; top:${((z+50)/100)*110}px;`;
                document.getElementById('minimap').appendChild(d);
            }
        }

        function setupControls() {
            let jb = document.getElementById('joy-base'), js = document.getElementById('joy-stick');
            let move = (e) => {
                e.preventDefault();
                let t = e.touches[0], r = jb.getBoundingClientRect();
                let dx = t.clientX - (r.left + 50), dy = t.clientY - (r.top + 50);
                let d = Math.min(Math.sqrt(dx*dx+dy*dy), 40);
                let a = Math.atan2(dy, dx);
                js.style.transform = `translate(calc(-50% + ${Math.cos(a)*d}px), calc(-50% + ${Math.sin(a)*d}px))`;
                joyX = Math.cos(a); joyZ = Math.sin(a); isMoving = true;
                if(isRecalling) stopRecall();
            };
            jb.addEventListener('touchstart', move); jb.addEventListener('touchmove', move);
            jb.addEventListener('touchend', () => { isMoving = false; joyX=0; joyZ=0; js.style.transform='translate(-50%,-50%)'; });

            let cz = document.getElementById('cam-zone'), sX, sY;
            cz.addEventListener('touchstart', e => { sX = e.touches[0].clientX; sY = e.touches[0].clientY; });
            cz.addEventListener('touchmove', e => {
                camPan.x += (e.touches[0].clientX - sX) * 0.03 * cfg.sens * cfg.invX;
                camPan.z += (e.touches[0].clientY - sY) * 0.03 * cfg.sens * cfg.invY;
                sX = e.touches[0].clientX; sY = e.touches[0].clientY;
            });
        }

        function doRecall() {
            if(isRecalling || isMoving) return;
            isRecalling = true;
            document.getElementById('msg').style.display = 'block';
            let t = 5;
            document.getElementById('timer').innerText = t;
            recallInterval = setInterval(() => {
                t--; document.getElementById('timer').innerText = t;
                if(t <= 0) { player.position.set(-35, 0, 35); stopRecall(); }
            }, 1000);
        }
        function stopRecall() { isRecalling = false; clearInterval(recallInterval); document.getElementById('msg').style.display = 'none'; }

        function animate() {
            requestAnimationFrame(animate);
            if(isMoving && !isRecalling) {
                let nX = player.position.x + joyX * 0.15, nZ = player.position.z + joyZ * 0.15;
                let hit = false;
                for(let o of obstacles) if(Math.sqrt((nX-o.position.x)**2+(nZ-o.position.z)**2) < o.userData.r + 0.6) hit = true;
                if(!hit && Math.abs(nX)<49 && Math.abs(nZ)<49) player.position.set(nX, 0, nZ);
                player.rotation.y = Math.atan2(-joyX, -joyZ);
            }
            camPan.x *= 0.9; camPan.z *= 0.9;
            camera.position.set(player.position.x + camPan.x, 15, player.position.z + 12 + camPan.z);
            camera.lookAt(player.position.x + camPan.x, 0, player.position.z + camPan.z);
            let d = document.getElementById('p-dot');
            if(d) { d.style.left = ((player.position.x+50)/100)*110+'px'; d.style.top = ((player.position.z+50)/100)*110+'px'; }
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
