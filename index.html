<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MLBB Camera & Platform</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; touch-action: none; }
        canvas { display: block; }

        /* Интерфейс джойстика */
        #joy-container {
            position: absolute; bottom: 50px; left: 50px;
            width: 120px; height: 120px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 50%;
        }
        #joy-stick {
            position: absolute; top: 50%; left: 50%;
            width: 50px; height: 50px;
            background: rgba(255,255,255,0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body>

    <div id="joy-container">
        <div id="joy-stick"></div>
    </div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

        // --- 1. СЦЕНА И КАРТА ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a1a);

        // Рендерер
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // Карта (Платформа)
        const ground = new THREE.Mesh(
            new THREE.PlaneGeometry(500, 500),
            new THREE.MeshStandardMaterial({ color: 0x222222 })
        );
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        // Сетка (чтобы видеть движение)
        const grid = new THREE.GridHelper(500, 100, 0x444444, 0x333333);
        scene.add(grid);

        // Свет
        scene.add(new THREE.AmbientLight(0xffffff, 0.6));
        const sun = new THREE.DirectionalLight(0xffffff, 0.8);
        sun.position.set(50, 100, 50);
        scene.add(sun);

        // --- 2. ГЕРОЙ ---
        const hero = new THREE.Mesh(
            new THREE.CapsuleGeometry(0.5, 1, 4, 8),
            new THREE.MeshStandardMaterial({ color: 0x00ff88 })
        );
        hero.position.y = 1;
        scene.add(hero);

        // --- 3. КАМЕРА (MLBB STYLE) ---
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        // Смещение камеры относительно героя
        const cameraOffset = new THREE.Vector3(0, 18, 12); 

        // --- 4. УПРАВЛЕНИЕ ---
        let moveX = 0, moveZ = 0, isMoving = false;
        const stick = document.getElementById('joy-stick');
        const container = document.getElementById('joy-container');

        const updateJoystick = (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = container.getBoundingClientRect();
            const cx = rect.left + rect.width / 2;
            const cy = rect.top + rect.height / 2;
            
            const dx = touch.clientX - cx;
            const dy = touch.clientY - cy;
            const dist = Math.min(Math.sqrt(dx*dx + dy*dy), 50);
            const angle = Math.atan2(dy, dx);

            stick.style.transform = `translate(calc(-50% + ${Math.cos(angle)*dist}px), calc(-50% + ${Math.sin(angle)*dist}px))`;
            
            moveX = Math.cos(angle) * (dist / 50);
            moveZ = Math.sin(angle) * (dist / 50);
            isMoving = true;
        };

        container.addEventListener('touchstart', updateJoystick, {passive: false});
        container.addEventListener('touchmove', updateJoystick, {passive: false});
        container.addEventListener('touchend', () => {
            isMoving = false;
            moveX = 0; moveZ = 0;
            stick.style.transform = 'translate(-50%, -50%)';
        });

        // --- 5. ГЛАВНЫЙ ЦИКЛ ---
        function animate() {
            requestAnimationFrame(animate);

            if (isMoving) {
                const speed = 0.2;
                hero.position.x += moveX * speed;
                hero.position.z += moveZ * speed;

                // Поворот героя в сторону бега
                hero.rotation.y = -Math.atan2(moveZ, moveX) + Math.PI / 2;
            }

            // МАГИЯ КАМЕРЫ:
            // 1. Устанавливаем позицию камеры как (Позиция героя + Смещение)
            camera.position.copy(hero.position).add(cameraOffset);
            
            // 2. Всегда заставляем камеру смотреть на героя
            camera.lookAt(hero.position);

            renderer.render(scene, camera);
        }

        animate();

        // Адаптация экрана
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
