<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MLBB: Pro Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; touch-action: none; font-family: sans-serif; user-select: none; }
        .screen { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; }
        
        /* –ö–û–ù–°–û–õ–¨ */
        #debug-log {
            position: absolute; top: 10px; left: 10px; width: 250px; max-height: 150px;
            background: rgba(0,0,0,0.9); color: #00ff00; font-family: monospace; font-size: 11px;
            padding: 10px; border-radius: 5px; overflow-y: auto; z-index: 1000;
            display: none; pointer-events: none; border: 1px solid #444;
        }

        /* –ú–ï–ù–Æ */
        #menu-screen { background: radial-gradient(circle, #0f172a, #000); }
        h1 { color: #f1c40f; font-size: 36px; text-shadow: 0 0 20px #f1c40f; margin-bottom: 30px; }
        
        #debug-toggle { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.5); color: #fff; border: 1px solid #fff; padding: 10px 15px; border-radius: 5px; cursor: pointer; z-index: 1100; pointer-events: auto; }

        /* –ù–ê–°–¢–†–û–ô–ö–ò */
        #settings-screen { background: #000; display: none; color: white; z-index: 600; }
        .s-row { width: 300px; display: flex; justify-content: space-between; align-items: center; margin: 20px 0; }
        
        .btn {
            background: linear-gradient(to bottom, #1e40af, #3b82f6); border: 2px solid #f1c40f;
            color: white; padding: 15px 40px; font-size: 18px; font-weight: bold; border-radius: 10px; cursor: pointer; margin: 10px;
        }

        /* –ò–ì–†–ê */
        #game-ui { display: none; pointer-events: none; }
        
        #minimap-container { 
            position: absolute; top: 15px; left: 15px; width: 120px; height: 120px; 
            background: rgba(0,20,0,0.8); border: 2px solid #555; border-radius: 8px; overflow: hidden;
        }
        #minimap-player { position: absolute; width: 6px; height: 6px; background: #fff; border-radius: 50%; z-index: 5; }

        #joy-base { position: absolute; bottom: 40px; left: 40px; width: 110px; height: 110px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.2); border-radius: 50%; pointer-events: auto; }
        #joy-stick { position: absolute; top: 50%; left: 50%; width: 45px; height: 45px; background: #fff; border-radius: 50%; transform: translate(-50%, -50%); opacity: 0.6; }
        
        #recall-btn { 
            position: absolute; bottom: 45px; right: 45px; width: 70px; height: 70px; 
            border-radius: 50%; background: #4338ca; border: 3px solid #fff; 
            color: white; display: flex; align-items: center; justify-content: center; 
            font-size: 30px; pointer-events: auto; box-shadow: 0 0 20px rgba(67, 56, 202, 0.6);
        }

        #msg { position: absolute; bottom: 180px; width: 100%; text-align: center; color: #22d3ee; font-size: 24px; font-weight: bold; display: none; text-shadow: 0 2px 10px #000; }
    </style>
</head>
<body>

    <div id="debug-log"></div>
    <div id="debug-toggle" onclick="toggleDebug()">DEBUG</div>

    <div id="menu-screen" class="screen">
        <h1>MOBA LEGENDS</h1>
        <button class="btn" onclick="initGame()">–ò–ì–†–ê–¢–¨</button>
        <button class="btn" onclick="toggleSettings(true)">–ù–ê–°–¢–†–û–ô–ö–ò</button>
    </div>

    <div id="settings-screen" class="screen">
        <h2>–ù–ê–°–¢–†–û–ô–ö–ò</h2>
        <div class="s-row"><span>–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</span><input type="range" id="sens" min="0.5" max="3" step="0.1" value="1.5"></div>
        <button class="btn" onclick="toggleSettings(false)">–ì–û–¢–û–í–û</button>
    </div>

    <div id="game-ui" class="screen">
        <div id="minimap-container"><div id="minimap-player"></div></div>
        <div id="joy-base"><div id="joy-stick"></div></div>
        <div id="msg">–í–û–ó–í–†–ê–©–ï–ù–ò–ï... <span id="timer">5</span></div>
        <div id="recall-btn" onclick="doRecall()">üè†</div>
        <div id="cam-zone" style="position:absolute; right:0; top:0; width:60%; height:100%; pointer-events:auto;"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        const logBox = document.getElementById('debug-log');
        let isDebug = false;
        function log(m) { 
            console.log(m);
            if(isDebug) {
                const d = document.createElement('div');
                d.innerText = "> " + m;
                logBox.appendChild(d);
                logBox.scrollTop = logBox.scrollHeight;
            }
        }
        function toggleDebug() { isDebug = !isDebug; logBox.style.display = isDebug ? 'block' : 'none'; log("–î–µ–±–∞–≥ –∞–∫—Ç–∏–≤–µ–Ω"); }

        let scene, camera, renderer, player, recallFx, obstacles = [];
        let moveX = 0, moveZ = 0, isMoving = false;
        let recalling = false, recallInt;
        let camDelta = { x: 0, z: 0 };
        let sensitivity = 1.5;

        function toggleSettings(show) { document.getElementById('settings-screen').style.display = show ? 'flex' : 'none'; }

        function initGame() {
            sensitivity = parseFloat(document.getElementById('sens').value);
            document.getElementById('menu-screen').style.display = 'none';
            document.getElementById('game-ui').style.display = 'block';

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);
            camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            const ambient = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambient);
            const sun = new THREE.DirectionalLight(0xffffff, 0.8);
            sun.position.set(20, 50, 20);
            scene.add(sun);

            // –ö–ê–†–¢–ê
            const ground = new THREE.Mesh(new THREE.PlaneGeometry(400, 400), new THREE.MeshStandardMaterial({color: 0x141e14}));
            ground.rotation.x = -Math.PI/2;
            scene.add(ground);

            const river = new THREE.Mesh(new THREE.PlaneGeometry(45, 400), new THREE.MeshStandardMaterial({color: 0x0ea5e9, transparent: true, opacity: 0.6}));
            river.rotation.x = -Math.PI/2; river.position.y = 0.1;
            scene.add(river);

            // –ë–ê–®–ù–ò –ò –ë–ê–ó–´
            createBuilding(-170, 170, 0x0066ff, 12); // –ë–∞–∑–∞ –°–∏–Ω–∏—Ö
            createBuilding(170, -170, 0xff0000, 12); // –ë–∞–∑–∞ –ö—Ä–∞—Å–Ω—ã—Ö
            
            // –ë–∞—à–Ω–∏ –Ω–∞ –º–∏–¥—É
            for(let i=1; i<=3; i++) {
                createTower(-45 - (i*30), 45 + (i*30), 0x0066ff);
                createTower(45 + (i*30), -45 - (i*30), 0xff0000);
            }

            // –ì–ï–†–û–ô (–ë–ï–ó CAPSULE GEOMETRY)
            player = new THREE.Group();
            const body = new THREE.Mesh(new THREE.CylinderGeometry(0.7, 0.7, 2.2, 12), new THREE.MeshStandardMaterial({color: 0x06b6d4}));
            body.position.y = 1.1;
            player.add(body);
            const sword = new THREE.Mesh(new THREE.BoxGeometry(0.2, 2.8, 0.2), new THREE.MeshStandardMaterial({color: 0xffffff}));
            sword.position.set(0.8, 1.5, 0.5); sword.rotation.x = 0.5;
            player.add(sword);

            recallFx = new THREE.Mesh(new THREE.CylinderGeometry(2.5, 2.5, 30, 16, 1, true), new THREE.MeshBasicMaterial({color: 0x22d3ee, transparent: true, opacity: 0, side: THREE.DoubleSide}));
            recallFx.position.y = 15;
            player.add(recallFx);

            scene.add(player);
            player.position.set(-150, 0, 150);

            setupControls();
            log("–ú–∏—Ä –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ");
            animate();
        }

        function createTower(x, z, col) {
            const g = new THREE.Group();
            const b = new THREE.Mesh(new THREE.CylinderGeometry(2, 2.5, 9, 8), new THREE.MeshStandardMaterial({color: 0x334155}));
            const top = new THREE.Mesh(new THREE.SphereGeometry(1.6), new THREE.MeshStandardMaterial({color: col}));
            top.position.y = 5.5; g.add(b); g.add(top); g.position.set(x, 4.5, z);
            scene.add(g); obstacles.push({x, z, r: 4});
            addMinimapIcon(x, z, col);
        }

        function createBuilding(x, z, col, s) {
            const b = new THREE.Mesh(new THREE.BoxGeometry(s, s*1.5, s), new THREE.MeshStandardMaterial({color: 0x1e293b}));
            const c = new THREE.Mesh(new THREE.OctahedronGeometry(s/2), new THREE.MeshStandardMaterial({color: col}));
            c.position.y = s; b.add(c); b.position.set(x, s*0.75, z);
            scene.add(b); obstacles.push({x, z, r: s/1.5});
            addMinimapIcon(x, z, col, true);
        }

        function addMinimapIcon(x, z, col, big) {
            const icon = document.createElement('div');
            const size = big ? 8 : 4;
            const hex = col === 0x0066ff ? '#00f' : '#f00';
            icon.style.cssText = `position:absolute; width:${size}px; height:${size}px; background:${hex}; left:${((x+200)/400)*120}px; top:${((z+200)/400)*120}px; border:1px solid #fff;`;
            document.getElementById('minimap-container').appendChild(icon);
        }

        function setupControls() {
            const jBase = document.getElementById('joy-base'), jStick = document.getElementById('joy-stick');
            const handleMove = (e) => {
                e.preventDefault();
                const t = e.touches ? e.touches[0] : e;
                const r = jBase.getBoundingClientRect();
                const dx = t.clientX - (r.left + 55), dy = t.clientY - (r.top + 55);
                const d = Math.min(Math.sqrt(dx*dx+dy*dy), 45);
                const a = Math.atan2(dy, dx);
                jStick.style.transform = `translate(calc(-50% + ${Math.cos(a)*d}px), calc(-50% + ${Math.sin(a)*d}px))`;
                moveX = Math.cos(a); moveZ = Math.sin(a); isMoving = true;
                if(recalling) stopRecall();
            };
            jBase.addEventListener('touchstart', handleMove); jBase.addEventListener('touchmove', handleMove);
            window.addEventListener('touchend', () => { isMoving = false; jStick.style.transform='translate(-50%,-50%)'; });

            const camZone = document.getElementById('cam-zone');
            let lastX, lastY;
            camZone.addEventListener('touchstart', e => { lastX = e.touches[0].clientX; lastY = e.touches[0].clientY; });
            camZone.addEventListener('touchmove', e => {
                camDelta.x += (e.touches[0].clientX - lastX) * 0.04 * sensitivity;
                camDelta.z += (e.touches[0].clientY - lastY) * 0.04 * sensitivity;
                lastX = e.touches[0].clientX; lastY = e.touches[0].clientY;
            });
        }

        function doRecall() {
            if(recalling || isMoving) return;
            log("–ó–∞–ø—É—Å–∫ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è...");
            recalling = true;
            document.getElementById('msg').style.display = 'block';
            recallFx.material.opacity = 0.5;
            let count = 5; document.getElementById('timer').innerText = count;
            recallInt = setInterval(() => {
                count--; document.getElementById('timer').innerText = count;
                if(count <= 0) { player.position.set(-150, 0, 150); stopRecall(); }
            }, 1000);
        }

        function stopRecall() { 
            recalling = false; clearInterval(recallInt); 
            document.getElementById('msg').style.display = 'none'; 
            recallFx.material.opacity = 0;
        }

        function animate() {
            requestAnimationFrame(animate);
            if(isMoving && !recalling) {
                let nX = player.position.x + moveX * 0.18;
                let nZ = player.position.z + moveZ * 0.18;
                let collision = false;
                obstacles.forEach(o => { if(Math.sqrt((nX-o.x)**2 + (nZ-o.z)**2) < o.r + 1) collision = true; });
                if(!collision && Math.abs(nX) < 195 && Math.abs(nZ) < 195) player.position.set(nX, 0, nZ);
                player.rotation.y = Math.atan2(-moveX, -moveZ);
            }
            if(recalling) recallFx.rotation.y += 0.1;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏–Ω–∏–∫–∞—Ä—Ç—ã
            const pMap = document.getElementById('minimap-player');
            pMap.style.left = ((player.position.x + 200) / 400 * 120 - 3) + 'px';
            pMap.style.top = ((player.position.z + 200) / 400 * 120 - 3) + 'px';

            camDelta.x *= 0.9; camDelta.z *= 0.9;
            camera.position.set(player.position.x + camDelta.x, 25, player.position.z + 20 + camDelta.z);
            camera.lookAt(player.position.x + camDelta.x, 0, player.position.z + camDelta.z);
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
